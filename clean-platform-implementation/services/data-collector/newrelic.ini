# New Relic Agent Configuration

[newrelic]
# License key is injected as environment variable
license_key = %(NEW_RELIC_LICENSE_KEY)s

# Application name - will be prefixed with environment
app_name = %(NEW_RELIC_APP_NAME)s

# Logging configuration
log_level = %(NEW_RELIC_LOG_LEVEL)s
log_file = stdout

# Enable high security mode for FedRAMP compliance
high_security = true

# Distributed tracing
distributed_tracing.enabled = true

# Transaction tracer
transaction_tracer.enabled = true
transaction_tracer.transaction_threshold = apdex_f
transaction_tracer.record_sql = obfuscated
transaction_tracer.stack_trace_threshold = 0.5
transaction_tracer.explain_enabled = true
transaction_tracer.explain_threshold = 0.5

# Error collector
error_collector.enabled = true
error_collector.ignore_errors = 

# Thread profiler
thread_profiler.enabled = true

# Custom instrumentation
# Add custom transaction names for our endpoints
transaction_name.rules = 
    /collect:DataCollector:collect
    /healthz:HealthCheck:liveness
    /readyz:HealthCheck:readiness
    /metrics:Monitoring:prometheus

# Attributes
attributes.enabled = true
attributes.include = request.method request.uri request.headers.* response.status

# Slow SQL
slow_sql.enabled = true

# Cross application tracer
cross_application_tracer.enabled = true

# Custom events
custom_insights_events.enabled = true
custom_insights_events.max_samples_stored = 3000

# Audit log for compliance
audit_log.enabled = true

# Labels for filtering in NR1
labels = team:platform-team;service:data-collector;tier:backend

# Capture request parameters (excluding sensitive data)
capture_params = true
ignored_params = password,token,api_key,secret

# Utilization detection
utilization.detect_aws = true
utilization.detect_docker = true
utilization.detect_kubernetes = true

# Infinite tracing (if using trace observer)
# infinite_tracing.trace_observer.host = YOUR_TRACE_OBSERVER_HOST
# infinite_tracing.trace_observer.port = 443